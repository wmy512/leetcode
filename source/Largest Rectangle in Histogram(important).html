<html>
<head>
  <title>Largest Rectangle in Histogram(important)</title>
  <basefont face="Tahoma" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/270387 (zh-CN); Windows/6.1.7601 Service Pack 1;"/>
  <style>
    body, td {
      font-family: Tahoma;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4048"/>
<h1>Largest Rectangle in Histogram(important)</h1>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><div style="box-sizing: border-box; margin-right: -15px; margin-left: -15px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; background-color: rgb(255, 255, 255);"><div style="box-sizing: border-box; position: relative; min-height: 1px; padding-right: 15px; padding-left: 15px; width: 1170px;"><div style="box-sizing: border-box; padding-bottom: 10px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);"><h3 style="box-sizing: border-box; font-weight: 500; line-height: 1.1; margin-top: 20px; margin-bottom: 10px; font-size: 24px; display: inline;">Largest Rectangle in Histogram</h3>
 <span style="box-sizing: border-box; color: rgb(58, 135, 173); margin-left: 30px; font-size: 13px; vertical-align: text-bottom;">Total Accepted: <strong style="box-sizing: border-box;">1452</strong></span> <span style="box-sizing: border-box; color: rgb(58, 135, 173); margin-left: 15px; font-size: 13px; vertical-align: text-bottom;">Total Submissions: <strong style="box-sizing: border-box;">7407</strong></span><a href="http://oj.leetcode.com/problems/largest-rectangle-in-histogram/submissions/" style="box-sizing: border-box; color: rgb(51, 51, 51); text-decoration: none; display: inline-block; padding: 6px 12px; margin-bottom: 0px; line-height: 1.428571429; text-align: center; white-space: nowrap; vertical-align: middle; cursor: pointer; border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; float: right !important;">My Submissions</a></div><div style="box-sizing: border-box; margin-right: -15px; margin-left: -15px;"><div style="box-sizing: border-box; position: relative; min-height: 1px; padding-right: 15px; padding-left: 15px; width: 1170px;"><div style="box-sizing: border-box; margin-left: 20px; line-height: 30px;"><p style="box-sizing: border-box; margin: 0px 0px 10px;"></p><p style="box-sizing: border-box; margin: 0px 0px 10px;">Given <i style="box-sizing: border-box;">n</i> non-negative integers representing the histogram's bar height where the width of each bar is 1, find the area of largest rectangle in the histogram.</p><p style="box-sizing: border-box; margin: 0px 0px 10px;"><img src="http://www.leetcode.com/wp-content/uploads/2012/04/histogram.png" style="cursor: default;cursor: default;cursor: default;"></img><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box; margin: 0px 0px 10px; font-size: 11px;">Above is a histogram where width of each bar is 1, given height = <code style="box-sizing: border-box; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 2px 4px; color: rgb(199, 37, 78); white-space: nowrap; background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px;">[2,1,5,6,2,3]</code>.</p><p style="box-sizing: border-box; margin: 0px 0px 10px;"></p><p style="box-sizing: border-box; margin: 0px 0px 10px;"><img src="http://www.leetcode.com/wp-content/uploads/2012/04/histogram_area.png" style="cursor: default;cursor: default;cursor: default;"></img><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box; margin: 0px 0px 10px; font-size: 11px;">The largest rectangle is shown in the shaded area, which has area = <code style="box-sizing: border-box; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; padding: 2px 4px; color: rgb(199, 37, 78); white-space: nowrap; background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px;">10</code> unit.</p><p style="box-sizing: border-box; margin: 0px 0px 10px;"></p><p style="box-sizing: border-box; margin: 0px 0px 10px;">For example,<br style="box-sizing: border-box;">
Given height = <code style="box-sizing: border-box; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; padding: 2px 4px; color: rgb(199, 37, 78); white-space: nowrap; background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px;">[2,1,5,6,2,3]</code>,<br style="box-sizing: border-box;">
return <code style="box-sizing: border-box; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; padding: 2px 4px; color: rgb(199, 37, 78); white-space: nowrap; background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px;">10</code>.</p><p style="box-sizing: border-box; margin: 0px 0px 10px;"></p></div></div></div></div></div><p style="box-sizing: border-box; margin: 12px 0px 10px; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 20px; background-color: rgb(255, 255, 255);"><a href="http://oj.leetcode.com/discuss/oj/largest-rectangle-in-histogram" style="box-sizing: border-box; color: rgb(255, 255, 255); text-decoration: none; display: inline-block; padding: 6px 20px; margin-bottom: 0px; font-size: 16px; line-height: 1.428571429; text-align: center; white-space: nowrap; vertical-align: middle; cursor: pointer; border: 1px solid rgb(76, 174, 76); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(92, 184, 92);">Discuss</a></p><br></div><div><br></div><div align="left"><font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">#include</span></font> <font color="#A31515" face="Consolas" size="1"><span style="font-size:9pt">&lt;iostream&gt;</span></font></div><div align="left"><font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">using</span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">namespace</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">std;</span></font></div><div align="left"><font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">#include</span></font> <font color="#A31515" face="Consolas" size="1"><span style="font-size:9pt">&lt;vector&gt;</span></font></div><div align="left"><font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">#include</span></font> <font color="#A31515" face="Consolas" size="1"><span style="font-size:9pt">&lt;string&gt;</span></font></div><div align="left"><font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">#include</span></font> <font color="#A31515" face="Consolas" size="1"><span style="font-size:9pt">&lt;queue&gt;</span></font></div><div align="left"><font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">#include</span></font> <font color="#A31515" face="Consolas" size="1"><span style="font-size:9pt">&lt;stack&gt;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt"><br></span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt"><br></span></font></div><div align="left"><font color="#008000" face="Consolas" size="1"><span style="font-size:9pt">// Definition for binary tree</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt"> </span></font><font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">struct</span></font> <font color="#2B91AF" face="Consolas" size="1"><span style="font-size:9pt">TreeNode</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">{</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">    </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">val;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">    </span></font> <font color="#2B91AF" face="Consolas" size="1"><span style="font-size:9pt">TreeNode</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">*left;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">    </span></font> <font color="#2B91AF" face="Consolas" size="1"><span style="font-size:9pt">TreeNode</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">*right;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">     TreeNode(</span></font><font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">x</span></font><font face="Consolas" size="1"><span style="font-size:9pt">) : val(</span></font><font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">x</span></font><font face="Consolas" size="1"><span style="font-size:9pt">), left(</span></font><font color="#6F008A" face="Consolas" size="1"><span style="font-size:9pt">NULL</span></font><font face="Consolas" size="1"><span style="font-size:9pt">), right(</span></font><font color="#6F008A" face="Consolas" size="1"><span style="font-size:9pt">NULL</span></font><font face="Consolas" size="1"><span style="font-size:9pt">) {}</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt"> };</span></font></div><div align="left"><font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">class</span></font> <font color="#2B91AF" face="Consolas" size="1"><span style="font-size:9pt">Solution</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">{</span></font></div><div align="left"><font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">public</span></font><font face="Consolas" size="1"><span style="font-size:9pt">:</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">largestRectangleArea(</span></font> <font color="#2B91AF" face="Consolas" size="1"><span style="font-size:9pt">vector</span></font><font face="Consolas" size="1"><span style="font-size:9pt">&lt;</span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font><font face="Consolas" size="1"><span style="font-size:9pt">&gt; &amp;</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">) {</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#008000" face="Consolas" size="1"><span style="font-size:9pt">// IMPORTANT: Please reset any member data you declared, as</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#008000" face="Consolas" size="1"><span style="font-size:9pt">// the same Solution instance will be reused for each test case.</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#008000" face="Consolas" size="1"><span style="font-size:9pt">// O(n2) timeout</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">if</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">(</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">.size() == 0) {</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">           </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">return</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">0;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">        }</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">min_v = 0;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">max_v = 0;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">for</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">(</span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">i = 0; i &lt;</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">.size(); i++) {</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">            min_v =</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">[i];</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">           </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">for</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">(</span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">j = i; j &lt;</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">.size(); j++) {</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">                min_v = min(min_v,</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">[j]);</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">                max_v = max(max_v, min_v * (j - i + 1));</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">            }</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">        }</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">return</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">max_v;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">    }</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">largestRectangleArea2(</span></font> <font color="#2B91AF" face="Consolas" size="1"><span style="font-size:9pt">vector</span></font><font face="Consolas" size="1"><span style="font-size:9pt">&lt;</span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font><font face="Consolas" size="1"><span style="font-size:9pt">&gt; &amp;</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">) {</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#008000" face="Consolas" size="1"><span style="font-size:9pt">// IMPORTANT: Please reset any member data you declared, as</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#008000" face="Consolas" size="1"><span style="font-size:9pt">// the same Solution instance will be reused for each test case.</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#008000" face="Consolas" size="1"><span style="font-size:9pt">// O(n)</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#008000" face="Consolas" size="1"><span style="font-size:9pt">// 第一次出错没有考虑min_stack最后不为空的情况（也可以在height最后添加0元素，但是申请了新的空间）</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#008000" face="Consolas" size="1"><span style="font-size:9pt">// 没有完全按照网上的max_v = max(max_v, height[t] * (stack.empty() ? i : i - stack.top() - 1)); 也没有完全理解。。导致出错</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt"><br></span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">if</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">(</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">.size() == 0) {</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">           </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">return</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">0;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">        }</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">max_v = 0;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#2B91AF" face="Consolas" size="1"><span style="font-size:9pt">stack</span></font><font face="Consolas" size="1"><span style="font-size:9pt">&lt;</span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font><font face="Consolas" size="1"><span style="font-size:9pt">&gt; min_stack;</span></font> <font color="#008000" face="Consolas" size="1"><span style="font-size:9pt">//存储比当前元素小的元素</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">index = 0;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">while</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">(index &lt;</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">.size()) {</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">           </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">if</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">(min_stack.empty() ||</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">[min_stack.top()] &lt;=</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">[index]) {</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">                min_stack.push(index++);</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">            }</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">           </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">else</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">{</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">               </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">t = min_stack.top();</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">                min_stack.pop();</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">                max_v = max(max_v,</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">[t] * (min_stack.empty() ? index : index - min_stack.top() - 1));</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">            }</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">        }</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">while</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">(!min_stack.empty()) {</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">           </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">t = min_stack.top();</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">            min_stack.pop();</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">            max_v = max(max_v,</span></font> <font color="#808080" face="Consolas" size="1"><span style="font-size:9pt">height</span></font><font face="Consolas" size="1"><span style="font-size:9pt">[t] * (min_stack.empty() ? index : index - min_stack.top() - 1));</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">           </span></font> <font color="#008000" face="Consolas" size="1"><span style="font-size:9pt">// 如果min_stack.empty(),说明height[t]是最小的元素，那么height[t] * index是它的面积</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">           </span></font> <font color="#008000" face="Consolas" size="1"><span style="font-size:9pt">// 如果不为空，那么index和min_stack.top()之间的bar都是 &gt;= height[t]的，一共有 index - min_stack.top() - 1 个</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">        }</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">       </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">return</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">max_v;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">    }</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">};</span></font></div><div align="left"><font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">main() {</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">   </span></font> <font color="#2B91AF" face="Consolas" size="1"><span style="font-size:9pt">Solution</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">so;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">a[] = {2,1,2,6,2,3};</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">   </span></font> <font color="#2B91AF" face="Consolas" size="1"><span style="font-size:9pt">vector</span></font><font face="Consolas" size="1"><span style="font-size:9pt">&lt;</span></font><font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">int</span></font><font face="Consolas" size="1"><span style="font-size:9pt">&gt; vi(a, a + 3);</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">    cout &lt;&lt; so.largestRectangleArea2(vi) &lt;&lt; endl;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">   </span></font> <font color="#0000FF" face="Consolas" size="1"><span style="font-size:9pt">return</span></font> <font face="Consolas" size="1"><span style="font-size:9pt">0;</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt">}</span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt"><br></span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt"><br></span></font></div><div align="left"><font face="Consolas" size="1"><span style="font-size:9pt"><br></span></font></div><div align="left"><p style="line-height: 19px; margin: 10px auto !important; color: rgb(75, 75, 75); font-family: Verdana, Geneva, Arial, Helvetica, sans-serif; font-size: 13px; text-align: start; background-color: rgb(255, 255, 255);"></p><div style="font-size: 14.7px; font-weight: bold; margin-bottom: 10px;"><a href="http://www.cnblogs.com/lichen782/p/leetcode_Largest_Rectangle_in_Histogram.html" style="text-decoration: none; color: rgb(26, 139, 200);">LeetCode 笔记系列 17 Largest Rectangle in Histogram</a></div><p>题目： <strong>Largest Rectangle in Histogram</strong></p><p>Given <em>n</em> non-negative integers representing the histogram's bar height where the width of each bar is 1, find the area of largest rectangle in the histogram.</p><p><img src="http://www.leetcode.com/wp-content/uploads/2012/04/histogram.png" style="cursor: default;"></img></p><p>Above is a histogram where width of each bar is 1, given height = <code>[2,1,5,6,2,3]</code>.</p><p> </p><p><img src="http://www.leetcode.com/wp-content/uploads/2012/04/histogram_area.png" style="cursor: default;"></img></p><p>The largest rectangle is shown in the shaded area, which has area = <code>10</code> unit.</p><p>For example,<br>
Given height = <code>[2,1,5,6,2,3]</code>,<br>
return <code>10</code>.</p><p><strong>解法一：</strong> 这样的题目一般都有O(n)的解法，因为O(n<sup>2</sup>)的解法实在是太显而易见了。</p><p>可悲的是，本娃就只写出了后者。。。代码如下：</p><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-family: 'Courier New' !important; font-size: 12px !important;"><img src="Largest Rectangle in Histogram(important)_files/Image.gif" type="image/gif" style="cursor: default;"/> <span style="line-height: 1.5 !important; border: 1px solid gray; background-color: rgb(255, 255, 255); padding: 2px;">View Code</span></div><p>基本思想就是遍历所有[i, j]，并在过程中找出中间最矮的bar，得出从i到j的矩形面积。</p><p>不过我就知道，一定有大神用他们极简的代码来切题，下面就是一个。</p><p><strong>解法二：</strong></p><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; font-family: 'Courier New' !important; font-size: 12px !important;"><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New' !important;"><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);"> 1</span> <span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">public</span> <span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">int</span> largestRectangleArea2(<span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">int</span><span style="line-height: 1.5 !important; color: rgb(0, 0, 0);">[] height) {
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);"> 2</span>         Stack&lt;Integer&gt; stack = <span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">new</span> Stack&lt;Integer&gt;<span style="line-height: 1.5 !important; color: rgb(0, 0, 0);">();
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);"> 3</span>         <span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">int</span> i = 0<span style="line-height: 1.5 !important; color: rgb(0, 0, 0);">;
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);"> 4</span>         <span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">int</span> maxArea = 0<span style="line-height: 1.5 !important; color: rgb(0, 0, 0);">;
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);"> 5</span>         <span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">int</span>[] h = <span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">new</span> <span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">int</span>[height.length + 1<span style="line-height: 1.5 !important; color: rgb(0, 0, 0);">];
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);"> 6</span>         h = Arrays.copyOf(height, height.length + 1<span style="line-height: 1.5 !important; color: rgb(0, 0, 0);">);
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);"> 7</span>         <span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">while</span>(i &lt;<span style="line-height: 1.5 !important; color: rgb(0, 0, 0);"> h.length){
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);"> 8</span>             <span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">if</span>(stack.isEmpty() || h[stack.peek()] &lt;=<span style="line-height: 1.5 !important; color: rgb(0, 0, 0);"> h[i]){
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);"> 9</span>                 stack.push(i++<span style="line-height: 1.5 !important; color: rgb(0, 0, 0);">);
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);">10</span>             }<span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">else</span><span style="line-height: 1.5 !important; color: rgb(0, 0, 0);"> {
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);">11</span>                 <span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">int</span> t =<span style="line-height: 1.5 !important; color: rgb(0, 0, 0);"> stack.pop();
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);">12</span>                 maxArea = Math.max(maxArea, h[t] * (stack.isEmpty() ? i : i - stack.peek() - 1<span style="line-height: 1.5 !important; color: rgb(0, 0, 0);">));
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);">13</span> <span style="line-height: 1.5 !important; color: rgb(0, 0, 0);">            }
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);">14</span> <span style="line-height: 1.5 !important; color: rgb(0, 0, 0);">        }
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);">15</span>         <span style="line-height: 1.5 !important; color: rgb(0, 0, 255);">return</span><span style="line-height: 1.5 !important; color: rgb(0, 0, 0);"> maxArea;
</span><span style="line-height: 1.5 !important; color: rgb(0, 128, 128);">16</span>     }
</pre></div><p>16行，给跪了。。。。</p><p>这个我不去debug下都特么不知道在干嘛。</p><p>那要不就debug下看看这段代码在做神马。例子就用题目中的<strong>[2,1,5,6,2,3]</strong>吧。</p><p>首先，如果栈是空的，那么索引i入栈。那么第一个i=0就进去吧。注意栈内保存的是索引，不是高度。然后i++。</p><p><img src="Largest Rectangle in Histogram(important)_files/Image.png" type="image/png" height="340" style="cursor: default;" width="237"/></p><p>然后继续，当i=1的时候，发现h[i]小于了栈内的元素，于是出栈。（由此可以想到，哦，看来stack里面只存放<span style="line-height: 1.5; font-size: 16px;"><strong>单调递增的索引</strong></span>）</p><p>这时候stack为空，所以面积的计算是h[t] * i.t是刚刚弹出的stack顶元素。也就是蓝色部分的面积。</p><p><img src="Largest Rectangle in Histogram(important)_files/Image [1].png" type="image/png" height="397" style="cursor: default;" width="246"/></p><p>继续。这时候stack为空了，继续入栈。注意到只要是连续递增的序列，我们都要keep pushing，直到我们遇到了i=4，h[i]=2小于了栈顶的元素。</p><p><img src="Largest Rectangle in Histogram(important)_files/Image [2].png" type="image/png" height="353" style="cursor: default;" width="243"/></p><p>这时候开始计算矩形面积。首先弹出栈顶元素，t=3。即下图绿色部分。</p><p><img src="Largest Rectangle in Histogram(important)_files/Image [3].png" type="image/png" height="411" style="cursor: default;" width="254"/></p><p>接下来注意到栈顶的（索引指向的）元素还是大于当前i指向的元素，于是出栈，并继续计算面积，桃红色部分。</p><p><img src="Largest Rectangle in Histogram(important)_files/Image [4].png" type="image/png" height="436" style="cursor: default;" width="270"/></p><p>最后，栈顶的（索引指向的）元素大于了当前i指向的元素，循环继续，入栈并推动i前进。直到我们再次遇到下降的元素，也就是我们最后人为添加的dummy元素0.</p><p><img src="Largest Rectangle in Histogram(important)_files/Image [5].png" type="image/png" height="411" style="cursor: default;" width="298"/></p><p><span style="line-height: 1.5; background-color: rgb(173, 216, 230);">同理，我们计算栈内的面积。由于当前i是最小元素，所以所有的栈内元素都要被弹出并参与面积计算。</span></p><p><img src="Largest Rectangle in Histogram(important)_files/Image [6].png" type="image/png" height="428" style="cursor: default;" width="310"/></p><p>注意我们在计算面积的时候已经更新过了maxArea。</p><p>总结下，我们可以看到，stack中总是保持递增的元素的索引，然后当遇到较小的元素后，依次出栈并计算栈中bar能围成的面积，直到栈中元素小于当前元素。</p><p>可是为什么这个方法是正确的呢？ 我也没搞清楚。只是觉得不明觉厉了。</p><p> -------------------------------------------------更新----------------------------------------------------------------</p><p>可以这样理解这个算法，看下图。</p><p><img src="Largest Rectangle in Histogram(important)_files/Image [7].png" type="image/png" height="362" style="cursor: default;" width="370"/></p><p>例如我们遇到最后遇到一个递减的bar（红色）。高度位于红线上方的（也就是算法中栈里面大于最右bar的）元素，他们是不可能和最右边的较小高度bar围成一个比大于在弹栈过程中的矩形面积了（黄色面积），因为红色的bar对他们来说是一个短板，和红色bar能围成的最大面积也就是红色的高度乘以这些“上流社会”所跨越的索引范围。但是“上流社会”的高度个个都比红色bar大，他们完全只计算彼此之间围成的面积就远远大于和红色bar围成的任意面积了。所以红色bar是不可能参与“上流社会”的bar的围城的（好悲哀）。</p><p>但是屌丝也不用泄气哦。因为虽然长度不占优势，但是团结的力量是无穷的。它还可以参与“比较远的”比它还要屌丝的bar的围城。他们的面积是有可能超过上流社会的面积的，因为距离啊！所以弹栈到比红色bar小就停止了。</p><p>另外一个细节需要注意的是，弹栈过程中面积的计算。</p><p><strong>h[t] * (stack.isEmpty() ? i : i - stack.peek() - 1)</strong></p><p><strong>h[t]</strong>是刚刚弹出的栈顶端元素。此时的面积计算是h[t]和前面的“上流社会”能围成的最大面积。这时候要注意哦，栈内索引指向的元素都是比h[t]小的，如果h[t]是目前最小的，那么栈内就是空哦。而在目前栈顶元素和h[t]之间（不包括h[t]和栈顶元素），都是大于他们两者的。如下图所示：</p><p><img src="Largest Rectangle in Histogram(important)_files/Image [8].png" type="image/png" height="254" style="cursor: default;" width="250"/></p><p>那h[t]无疑就是Stack.Peek和t之间那些上流社会的短板啦，而它们的跨越就是i - Stack.Peek - 1。</p><p>所以说，这个弹栈的过程也是维持程序不变量的方法啊：<span style="line-height: 1.5; font-size: 18pt;"><strong>栈内元素一定是要比当前i指向的元素小的。</strong></span></p><p>----------------------------------------------------------------------------------华丽------------------------------------------------------------------------------------------------------------------------</p><p>我只想问算法的作者，他们到底是怎么想出来的，在这么短的时间内。是不是有一些类似的研究或者算法给他们以灵感？</p><p>太有画面感了有木有！</p><br></div></div>
</div></body></html> 